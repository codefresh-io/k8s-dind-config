---
apiVersion: batch/v1
kind: Job
metadata:
  name: k8s-dind-config
  labels:
    app: dind
spec:
  template:
    metadata:
      name: k8s-dind-config
      labels:
        app: dind
    spec:
      restartPolicy: Never
      containers:
      - image: codefresh/k8s-dind-config:master
        name: k8s-dind-config
        imagePullPolicy: Always
        lifecycle:
          postStart:
            exec:
              command:
                - "/bin/bash"
                - "-c"
                - |
                  echo "192.168.99.100  codefresh.dev" >> /etc/hosts
        command:
          - "/app/k8s-dind-config"
#           - "/bin/bash"
#           - "-c"
#           - |
#             while true
#             do
#               date; sleep 60
#             done
        env:
        - name: NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        - name: API_HOST
          value: "http://codefresh.dev"
        - name: SIGN_API_PATH
          value: "/api/pki/signServerCerts"
        - name: TOKEN
          value: ""
